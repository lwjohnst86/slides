---
title: "A data-driven approach at characterizing heterogeneity in neuropathy assessments"
author: "Luke Johnston"
output:
  xaringan::moon_reader:
    self_contained: true
    lib_dir: libs
    css: ["xaringan-themer.css", "resources/custom.css"]
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

layout: true

<div class="footer">
<img src="resources/au_logo_black.png" alt="Aarhus University", width="160">
https://gitlab.com/lwjohnst/neuropathy.clusters
</div> 

```{r setup, include=FALSE}
stop("WON'T WORK, NEEDS ORIGINAL DATA SOURCE.")
options(htmltools.dir.version = FALSE)
library(kableExtra)
library(tidyverse)
knitr::opts_chunk$set(
  echo = FALSE,
  dev = "png",
  dpi = 150,
  comment = "#>",
  message = FALSE,
  warning = FALSE
)
set.seed(12314)
devtools::load_all()
```

```{r xaringan-themer, include=FALSE}
library(xaringanthemer)
mono_accent(
    base_color = "#105059",
    header_font_google = google_font("Poppins"),
    text_font_google = google_font("Oxygen"),
    text_font_size = "25px"
)
```

```{r load-data}
project_data <- load_data(raw_data_location)
neuropathy_data <- wrangle_neuropathy_data(project_data)
```

---

## PURPOSE: 

Get feedback, comments on two issues:

- Analysis implementation

- Extracting key results

---

class: middle, center

# BACKGROUND

---

## Diabetic neuropathy: Major complication without strong definition

--

- Many assessments:
    - DN4, UENS, TCSS, mTCSS, Monofilament-based, MNSI, Heart rate variability,
    Sural nerve conduction

--

- No consensus on assessing neuropathy

---

## Study objectives

- Are there specific groups of people who share similar assessment responses?

--

- Are some assessment tools better at capturing features of neuropathy?

--

- Based on above, could we simplify what assessment items to give and use the
responses?

---

## Study and measurements

```{r methods-inline}
sample_size <- neuropathy_data$all_vars %>% 
    select(-ID) %>% 
    dim()
num_persons <- sample_size[1]
num_items <- sample_size[2]
```

- Cohort: ~13 year followup of ADDITION-DK (n=`r num_persons`)

- Measures: 8 different neuropathy assessment tools (`r num_items` total items)

---

## Rationale on statistical analysis

```{r}
fake_data <- matrix(dimnames = list(rep(NA, 8), c("ID", str_c("A", 1:6))), ncol = 7, nrow = 8) %>% 
    as_tibble() %>% 
    mutate(ID = 1:8) %>% 
    mutate_at(vars(-ID), ~sample(c("present", "absent"), 8, replace = TRUE)) 

base_table <- fake_data %>% 
    kable() %>% 
    kable_styling(bootstrap_options = c("striped", "condensed")) %>% 
    column_spec(1, bold = TRUE)

base_table
```

---

## Groups by row: Hierarchical cluster (HCA)

```{r}
base_table %>% 
    row_spec(1:6, background = "lightblue") %>% 
    row_spec(7:8, background = "lightgreen")
```

---

## "Groups" by variable: Factor analysis

```{r}
base_table %>% 
    column_spec(2:3, background = "lightblue") %>% 
    column_spec(4:7, background = "lightgreen")
```

---

class: middle, center

# FIRST ISSUE: 

### Both methods data-specific, with fixed groups.

### What is *likelihood* individual will be in group?

---

class: middle, center

# My idea for implementation: 

### Run methods on resampled sets (4-fold CV, x 25)

---

```{r}
fake_data %>% 
    filter(row_number(ID) %in% c(1, 3, 6, 7)) %>% 
    kable() %>% 
    kable_styling(bootstrap_options = c("striped", "condensed")) %>% 
    column_spec(1, bold = TRUE) %>% 
    row_spec(c(4), background = "lightgreen") %>% 
    row_spec(1:3, background = "lightblue")
```

--

&nbsp;

```{r}
fake_data %>% 
    filter(row_number(ID) %in% c(2, 5, 7, 8)) %>% 
    kable() %>% 
    kable_styling(bootstrap_options = c("striped", "condensed")) %>% 
    column_spec(1, bold = TRUE) %>% 
    row_spec(3:4, background = "lightgreen") %>% 
    row_spec(1:2, background = "lightblue")
```


---

## HCA results: Likelihood of group membership

```{r fig-hca-cluster-likelihood, fig.width=7, fig.height=3, out.width="80%", fig.align="center"}
hca_results$all_vars %>%
  plot_hca_cluster_membership() +
  theme(axis.title.x = element_blank())
```

.footnote[Focusing on HCA for time.]

---

class: middle, center

# SECOND ISSUE: 

### What are common responses by group?

---

### This is 50 rows of what results look like:

```{r}
hca_with_assessments$all_vars$k3 %>%
    tidy_hca_neuropathy() %>%
    filter(NeuropathyValue != "pass") %>%
    select(ClusterNumber, Questionnaire, AssessmentResponse, MeanPercent) %>% 
    sample_n(50) %>% 
    arrange(ClusterNumber, desc(MeanPercent)) %>% 
    kable() %>%
    kable_styling(bootstrap_options = c("striped", "condensed")) %>%
    scroll_box(height = "350px")
```

---

class: middle, center

## How to make sense of this data?

## How to extract meaning?
