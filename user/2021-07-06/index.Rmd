---
title: "NetCoupler: Inferring causal pathways between high-dimensional metabolomics data and external factors"
author:
    - Luke W. Johnston
    - Clemens Wittenbecher
    - Fabian Eichelmann
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["useR", "useR-fonts", "extra.css"]
    #css: "xaringan-themer.css"
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

layout: true

<!-- To UseR 2021 

Bio:

Diabetes epidemiologist, R teacher, create R packages and tutorials to help researchers do reproducible and open science more easily. Personal site: https://lukewjohnston.com/

Slides are found here: https://slides.lwjohnst.com/user/2021-07-06/

-->

<div class="my-footer">
Slides: <a href="https://slides.lwjohnst.com/user/2021-07-06/">slides.lwjohnst.com/user/2021-07-06</a>
<br>Package: <a href="https://github.com/NetCoupler/NetCoupler/">github.com/NetCoupler/NetCoupler</a>
</div> 

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.align = "center"
)

image_nc_path <- function(.file) {
    fs::path("..", "..", "au-ph", "2019-08-15", "images", .file)
}

image_iarc_path <- function(.file) {
    fs::path("..", "..", "iarc", "2020-12-16", "images", .file)
}

library(xaringanthemer)
xaringanthemer::style_extra_css(
    list(
        "div.my-footer" = list(
            position = "absolute",
            background = "transparent",
            bottom = "0px",
            left = "140px",
            height = "50px",
            "font-size" = "20px"
        ),
        ".remark-slide-content" = list(
            "font-size" = "24px"
        )
    ),
    outfile = "extra.css",
    append = FALSE
)
```

```{r use-logo}
xaringanExtra::use_logo(
  image_url = "../../common/dda-sdca-logos.png",
  width = "110px"
)
```

```{r image-alt-and-cap-text, include=FALSE}
alt_questions_form <- "Diagram showing an exposure variable connected by lines to a network of metabolite variables within circles, that are then connected to an outcome variable."
cap_questions_form <- "Use NetCoupler to answer questions of this form (M = metabolite)."
alt_nc_phases <- "Diagram with four distinct areas representing the phases.
First phase shows a network of nodes called N commnected by lines that has been derived.
Second phase shows one node, called the index node, as an example of being iteratively selected, 
along with the other nodes it is connected to, called neighbour nodes.
Third phase shows a series of diagrams that are calculated for all combinations of
the index node with its neighbouring nodes. There are eight of these diagrams. Each
diagram represents a model for the next phase.
Fourth phase shows that each model from the previous phase is classified into
direct, ambigious, or no effect. This classification happens separately for 
exposures, called E, and outcomes, called O."
cap_nc_phases <- "Overview of the four phases."
alt_nc_pathways <- ""
cap_nc_pathways <- ""
```

<!--

Instructions:

- Timing:
    - 5 min
    - ~100-150 wpm = 500-750 words total
- Video:
    - Show face (picture-in-picture layout)
    - OBS Studio/Simple Screen Recorder
    - Describe headers, graphics
    - Speak each word on slides
    - Describe what and why
- Content:
    - Include speakers notes
    - Include alt-text
    - Include transcript

-->

---

## Designed to identify *potential* causal factors from complex networks

.pull-left[

**Motivation**:

- Moderately high dimensional and complex network data (e.g. metabolomics)
- Derive potential network structure
- Estimate causal pathways:
    - From exposure (e.g. exercise) to network
    - From network to outcome (e.g. diabetes)
    - From exposure to outcome, through the network
]

.pull-right[
```{r img-questions-form, out.width="100%", fig.alt=alt_questions_form, fig.cap=cap_questions_form}
knitr::include_graphics(image_nc_path("network.png"))
```
]

???

---

## Main features of NetCoupler 


.pull-left[
- Finds most likely network structure

- Can include exposure and/or outcome

- Identifies *potential* causal links from, to, and within the network
]

.pull-right[
- Flexible in type of model used (e.g. linear, logistic, cox regression)

- Allows adjusting for confounders and covariates

- Results output designed to be visualized (e.g. with tidygraph/ggraph packages)
]

---

## Four basic phases of the algorithm

```{r img-nc-phases, out.width="90%", fig.alt=alt_nc_phases, fig.cap=cap_nc_phases}
knitr::include_graphics(image_iarc_path("netcoupler-process.svg"))
```

???

---

## Example use with R code

.pull-left[
```{r example-nc-code, eval=FALSE, echo=TRUE}
library(NetCoupler)
std_data <- dataset %>% 
    nc_standardize(
        starts_with("metabolite")
    )

network <- std_data %>% 
    nc_estimate_network(
        starts_with("metabolite")
    ) %>% 
    as_edge_tbl()

outcome_estimates <- std_data %>%
    nc_estimate_outcome_links(
        edge_tbl = network,
        outcome = "HbA1c",
        model_function = lm
    )
```
]

.pull-right[
- Data needs to be standardized

- Need network to be an edge table (columns for start and end nodes)
]

???

---

## Graphical model output allows visual inference of *potential* pathways

```{r img-nc-pathways, out.width="85%", fig.alt=alt_nc_pathways, fig.cap=cap_nc_pathways}
knitr::include_graphics(image_nc_path("nc-causal-pathways.png"))
```

???


---

## Current limitations and areas of improvement

.pull-left[
- Application:
    - Focused on topics with few connected intermediate factors (e.g.
    metabolic data) linking exposures (e.g. exercise) to outcomes (diabetes)

- Conceptual:
    - Tricky to visualize (too many paths and variables)
    - Difficult to interpret output estimates
    - Not suited to pure exploration, should have some theoretical basis
]

--

.pull-right[
- Modeling:
    - Heavily relies on p-values
    - Only tested on cross-sectional/time-to-event data

- Software:
    - Slow performance
    - Untested on networks with >25 variables
    - Probably not sensible for *very* high-dimensional data (e.g. genomics)
]

???

---

class: middle

# Thanks!

???

